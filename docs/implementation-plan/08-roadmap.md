# Part 8: Implementation Roadmap

**Last Updated**: October 17, 2025

---

## üóìÔ∏è 6-Week Implementation Timeline

Complete phase-by-phase breakdown with deliverables and testing.

---

## üìÖ Phase 1: Database Setup (Week 1)

**Duration**: 3-4 days

### Tasks

1. **Add Subscription Model**
   ```bash
   # Update schema.prisma
   npx prisma migrate dev --name add_subscriptions_and_modules
   ```
   - Add `OrganizationSubscription` model
   - Add `OrganizationModule` model
   - Create relations to Organization

2. **Seed Module Definitions**
   ```bash
   # Run seed script
   pnpm tsx prisma/seed-modules.ts
   ```
   - Add visitors, tickets, inventory modules
   - Set default descriptions

3. **Create Default Subscription**
   - Write migration script to add Free plan to existing orgs
   - Test rollback scenario

### Deliverables

- ‚úÖ Migration applied successfully
- ‚úÖ Seed data created (3 modules)
- ‚úÖ Existing organizations have Free plan
- ‚úÖ Foreign keys working correctly

### Testing Checklist

- [ ] Run migration on clean database
- [ ] Run migration on database with existing orgs
- [ ] Verify seed creates exactly 3 modules
- [ ] Check cascade deletes work (org deletion)
- [ ] Rollback and reapply migration

---

## üîê Phase 2: Permission System (Week 1-2)

**Duration**: 4-5 days

### Tasks

1. **Update Better Auth Configuration**
   ```tsx
   // lib/auth.ts
   import { createAccessControl } from "better-auth";
   
   // Add statement and roles
   ```
   - Define statement with 10 resources
   - Create owner, admin, member roles
   - Test with `ac.check()` examples

2. **Create Permission Utilities**
   - `getEffectiveRole()` helper
   - System admin override logic
   - Server-side `checkPermission()` wrapper

3. **Build Client Providers**
   ```tsx
   // components/permissions-provider.tsx
   // components/conditional-render.tsx
   ```

### Deliverables

- ‚úÖ Access control configured in `lib/auth.ts`
- ‚úÖ Three roles with correct permissions
- ‚úÖ System admin override working
- ‚úÖ Client-side permission hooks ready

### Testing Checklist

- [ ] System admin can access all orgs as "owner"
- [ ] Org owner can manage all except delete subscription
- [ ] Org admin cannot delete org or manage subscriptions
- [ ] Member has read-only access to most resources
- [ ] Permission checks return consistent results server/client

---

## üõ£Ô∏è Phase 3: Routing & Layouts (Week 2)

**Duration**: 3-4 days

### Tasks

1. **Update Root Page**
   ```tsx
   // app/page.tsx
   // Implement smart redirect logic
   ```
   - Check session
   - Determine active org
   - Redirect based on role

2. **Enhance Organization Layout**
   ```tsx
   // app/(organization)/org/[slug]/layout.tsx
   // Add system admin role override
   ```
   - Grant virtual "owner" role to system admins
   - Pass organization data to children

3. **Create Module Access Middleware**
   ```tsx
   // app/(organization)/org/[slug]/modules/[moduleKey]/_lib/check-module-access.ts
   ```
   - Verify module is enabled
   - Check user has permission
   - Return clear error messages

### Deliverables

- ‚úÖ Smart entry point at `/`
- ‚úÖ System admins can access all org workspaces
- ‚úÖ Module routes protected by middleware
- ‚úÖ Breadcrumbs and navigation working

### Testing Checklist

- [ ] System admin visits `/` ‚Üí redirects to `/admin`
- [ ] User with 1 org visits `/` ‚Üí redirects to `/org/[slug]`
- [ ] User with 0 orgs visits `/` ‚Üí redirects to `/no-organization`
- [ ] Non-member tries to access org ‚Üí 403 error
- [ ] User tries to access disabled module ‚Üí error message

---

## üß© Phase 4: Module Management (Week 3)

**Duration**: 5-6 days

### Tasks

1. **Admin Module Toggle Page**
   ```tsx
   // app/(admin)/admin/organizations/[id]/modules/page.tsx
   ```
   - Display all 3 modules as cards
   - Add toggle switches
   - Show enabled/disabled status

2. **Module Toggle Action**
   ```tsx
   // Server action with validation
   ```
   - Check system admin permission
   - Validate against subscription limits
   - Update module status
   - Revalidate cache

3. **User-Facing Module Check**
   ```tsx
   // OrgNav component updates
   ```
   - Show/hide module links based on `isEnabled`
   - Display "coming soon" for disabled modules

### Deliverables

- ‚úÖ System admins can enable/disable modules
- ‚úÖ Module status persists in database
- ‚úÖ OrgNav reflects module availability
- ‚úÖ Access attempts to disabled modules are blocked

### Testing Checklist

- [ ] Enable module ‚Üí appears in OrgNav
- [ ] Disable module ‚Üí removed from OrgNav
- [ ] Try to enable 3rd module on Free plan ‚Üí blocked
- [ ] Upgrade subscription ‚Üí can enable more modules
- [ ] Module settings JSON stored correctly

---

## üë• Phase 5: Member Management (Week 3-4)

**Duration**: 5-6 days

### Tasks

1. **Members List Page**
   ```tsx
   // app/(organization)/org/[slug]/members/page.tsx
   ```
   - Display members with avatars
   - Show role badges
   - Add "Invite" button (conditional)

2. **Invite Member Flow**
   ```tsx
   // Invite form + server action
   ```
   - Email validation (Zod)
   - Role selection dropdown
   - Send invitation via Better Auth
   - Check member limit

3. **Remove Member Action**
   ```tsx
   // Delete member with confirmation
   ```
   - Prevent removing self
   - Prevent removing last owner
   - Show success toast

4. **Update Role Action**
   ```tsx
   // Edit role with validation
   ```
   - Prevent downgrading self
   - Check permissions

### Deliverables

- ‚úÖ Members page with full CRUD
- ‚úÖ Invitation system working
- ‚úÖ Role updates persist correctly
- ‚úÖ Member limits enforced

### Testing Checklist

- [ ] Owner can invite admin/member
- [ ] Admin can invite member (not owner)
- [ ] Member cannot invite anyone
- [ ] Cannot exceed plan's member limit
- [ ] Remove member ‚Üí disappears from list
- [ ] Update role ‚Üí badge changes immediately

---

## üí≥ Phase 6: Subscription Management (Week 4-5)

**Duration**: 4-5 days

### Tasks

1. **Subscription Settings Page**
   ```tsx
   // app/(organization)/org/[slug]/settings/subscription/page.tsx
   ```
   - Display current plan
   - Show usage stats (modules, members)
   - Add upgrade/downgrade buttons

2. **Plan Comparison Component**
   ```tsx
   // Show feature differences
   ```
   - Free: 2 modules, 10 members
   - Monthly: 5 modules, 50 members, $49/mo
   - Yearly: Unlimited, $490/yr

3. **Update Subscription Action**
   ```tsx
   // Stripe integration placeholder
   ```
   - Validate plan transition
   - Update database
   - Handle downgrades (disable excess modules)

4. **Subscription Enforcement**
   ```tsx
   // Add checks to invite/module actions
   ```
   - Block invites if at member limit
   - Block module enable if at module limit

### Deliverables

- ‚úÖ Subscription page shows current plan
- ‚úÖ Upgrade/downgrade flow works
- ‚úÖ Limits enforced throughout app
- ‚úÖ Downgrade disables excess features gracefully

### Testing Checklist

- [ ] Free plan shows 2/2 modules enabled
- [ ] Try to enable 3rd module ‚Üí error
- [ ] Upgrade to Monthly ‚Üí can enable 5 modules
- [ ] Try to invite 51st member on Monthly ‚Üí blocked
- [ ] Downgrade disables extra modules automatically

---

## ‚öôÔ∏è Phase 7: Settings & Polish (Week 5)

**Duration**: 4-5 days

### Tasks

1. **Organization Settings Pages**
   ```tsx
   // General settings (name, slug)
   // Security settings (future: 2FA)
   ```

2. **User Profile Settings**
   ```tsx
   // Update name, email, password
   // Avatar upload (future)
   ```

3. **Navigation Enhancements**
   - Add breadcrumbs to all pages
   - Mobile menu improvements
   - Active state indicators

4. **Empty States**
   - No organizations
   - No members
   - Module disabled messages

### Deliverables

- ‚úÖ Settings pages functional
- ‚úÖ Navigation polished
- ‚úÖ Empty states informative
- ‚úÖ Mobile responsive

### Testing Checklist

- [ ] Update org name ‚Üí reflects in all places
- [ ] Update user profile ‚Üí avatar shows correctly
- [ ] Mobile menu opens/closes smoothly
- [ ] Empty states show correct CTAs

---

## üß™ Phase 8: Testing & Launch (Week 6)

**Duration**: 5-7 days

### Tasks

1. **End-to-End Testing**
   - Create test scenarios for each persona
   - Test all permission combinations
   - Verify subscription transitions

2. **Security Audit**
   - Review all server actions
   - Check permission bypasses
   - Test SQL injection points

3. **Performance Optimization**
   - Add database indexes
   - Optimize queries (N+1 issues)
   - Cache organization data

4. **Documentation**
   - User guides for each role
   - Admin manual
   - API documentation

### Deliverables

- ‚úÖ All tests passing
- ‚úÖ Security vulnerabilities fixed
- ‚úÖ Performance benchmarks met
- ‚úÖ Documentation complete

### Testing Checklist

**System Admin Tests**
- [ ] Can create organizations
- [ ] Can enable/disable modules
- [ ] Can access all org workspaces
- [ ] Can view subscription details

**Organization Owner Tests**
- [ ] Can invite all roles
- [ ] Can update org settings
- [ ] Can manage subscriptions
- [ ] Cannot delete own org if only owner

**Organization Admin Tests**
- [ ] Can invite members only
- [ ] Cannot manage subscriptions
- [ ] Cannot delete organization
- [ ] Can use all enabled modules

**Organization Member Tests**
- [ ] Cannot invite anyone
- [ ] Can view members list
- [ ] Can use enabled modules (if permissions allow)
- [ ] Cannot access settings

**Permission Enforcement**
- [ ] Non-member blocked from org workspace
- [ ] Module access blocked if disabled
- [ ] Feature limits enforced (members, modules)
- [ ] System admin override works everywhere

---

## üìä Timeline Summary

| Phase | Week | Focus | Days |
|-------|------|-------|------|
| 1 | 1 | Database Setup | 3-4 |
| 2 | 1-2 | Permission System | 4-5 |
| 3 | 2 | Routing & Layouts | 3-4 |
| 4 | 3 | Module Management | 5-6 |
| 5 | 3-4 | Member Management | 5-6 |
| 6 | 4-5 | Subscriptions | 4-5 |
| 7 | 5 | Settings & Polish | 4-5 |
| 8 | 6 | Testing & Launch | 5-7 |

**Total**: 6 weeks (33-42 working days)

---

## üöÄ Launch Readiness Criteria

Before going to production:

1. ‚úÖ All 8 phases complete
2. ‚úÖ Database migrations tested on staging
3. ‚úÖ All 4 personas tested with real users
4. ‚úÖ Security audit passed
5. ‚úÖ Performance benchmarks met (< 500ms page loads)
6. ‚úÖ Error monitoring configured (Sentry)
7. ‚úÖ Backup strategy in place
8. ‚úÖ Rollback plan documented

---

**Next**: [Part 9: Key Decisions & FAQ ‚Üí](./09-decisions.md)
